#!/bin/bash

# Function to validate IP address
function validate_ip() {
    local ip=$1
    local valid_ip_regex="^([0-9]{1,3}\.){3}[0-9]{1,3}$"
    if [[ $ip =~ $valid_ip_regex ]]; then
        return 0
    else
        return 1
    fi
}

# Define WAN address. Could be used to scan a LAN address, subnet etc. as well.
echo "Enter the WAN address you want to scan"
read -p 'WAN: ' WAN

# Validate WAN address
if ! validate_ip $WAN; then
    echo "Invalid WAN address. Please enter a valid IP address."
    exit 1
fi

# Prompt user for output folder
echo "Enter the output folder"
read -p 'Output: ' Output

# Check if output folder is writable
if [ ! -d "$Output" ]; then
    echo "Output folder does not exist. Creating folder."
    mkdir -p $Output
elif [ ! -w "$Output" ]; then
    echo "Output folder is not writable. Please check permissions or path"
    exit 1
fi

# Define output file name based on WAN address and current timestamp
timestamp=$(date +%Y%m%d_%H%M%S)
output_file="$Output/scan_${WAN}_$timestamp.txt"

# Execute nmap scan
echo "Starting nmap scan on $WAN. Results will be saved to $output_file"
nmap -A -T4 $WAN -p- -Pn -oN $output_file

echo "\e[1;31m nmap scan completed. Results saved to $output_file \e[0m"
